{% extends 'ICANDEP/base.html' %}

{% block title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢{% endblock %}
{% block page_title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà{% endblock %}

{% block content %}
<div class="row">
    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold" style="color: var(--text-primary);">
                    <i class="bi bi-tags me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </h6>
            </div>
            <div class="card-body">
                {% if categories %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cat in categories %}
                                <tr>
                                    <td>
                                        <strong>{{ cat.name }}</strong>
                                        {% if cat.description %}
                                            <br><small class="text-muted">{{ cat.description }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if cat.transaction_type == 'income' %}
                                            <span class="badge badge-income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
                                        {% else %}
                                            <span class="badge badge-expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if cat.is_active %}
                                            <span class="badge bg-success">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                                        {% else %}
                                            <span class="badge bg-secondary">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if cat.icon %}
                                            <i class="bi {{ cat.icon }}"></i>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'ICANDEP:delete_category' cat.pk %}" 
                                           class="btn btn-sm btn-outline-danger" 
                                           title="‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà"
                                           onclick="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà \"{{ cat.name }}\"?\n\n‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ')">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-inbox fs-1 text-muted"></i>
                        <p class="text-muted mt-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold" style="color: var(--text-primary);">
                    <i class="bi bi-plus-circle me-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà
                </h6>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="{{ form.name.id_for_label }}" class="form-label">
                            {{ form.name.label }} <span class="text-danger">*</span>
                        </label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="text-danger small mt-1">
                                {% for error in form.name.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.transaction_type.id_for_label }}" class="form-label">
                            {{ form.transaction_type.label }} <span class="text-danger">*</span>
                        </label>
                        {{ form.transaction_type }}
                        {% if form.transaction_type.errors %}
                            <div class="text-danger small mt-1">
                                {% for error in form.transaction_type.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">
                            {{ form.description.label }}
                        </label>
                        {{ form.description }}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.icon.id_for_label }}" class="form-label">
                            {{ form.icon.label }}
                        </label>
                        <div class="input-group">
                            {{ form.icon }}
                            <button type="button" class="btn btn-outline-secondary" id="emojiPickerBtn" title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥">
                                üòÄ
                            </button>
                        </div>
                        <div id="emojiPicker" class="mt-2" style="display: none;">
                            <div class="card" style="background: var(--bg-tertiary); border: 1px solid var(--border-color);">
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥:</small>
                                    </div>
                                    <div class="emoji-grid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; max-height: 200px; overflow-y: auto;">
                                        <!-- ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö -->
                                        <span class="emoji-btn" data-emoji="üí∞" title="‡πÄ‡∏á‡∏¥‡∏ô">üí∞</span>
                                        <span class="emoji-btn" data-emoji="üíµ" title="‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£">üíµ</span>
                                        <span class="emoji-btn" data-emoji="üí≥" title="‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï">üí≥</span>
                                        <span class="emoji-btn" data-emoji="üìà" title="‡∏Å‡∏£‡∏≤‡∏ü‡∏Ç‡∏∂‡πâ‡∏ô">üìà</span>
                                        <span class="emoji-btn" data-emoji="‚úÖ" title="‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à">‚úÖ</span>
                                        
                                        <!-- ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
                                        <span class="emoji-btn" data-emoji="üçî" title="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå">üçî</span>
                                        <span class="emoji-btn" data-emoji="üçï" title="‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤">üçï</span>
                                        <span class="emoji-btn" data-emoji="üçú" title="‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß">üçú</span>
                                        <span class="emoji-btn" data-emoji="üç±" title="‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πà‡∏≠‡∏á">üç±</span>
                                        <span class="emoji-btn" data-emoji="üçõ" title="‡∏Ç‡πâ‡∏≤‡∏ß‡πÅ‡∏Å‡∏á">üçõ</span>
                                        <span class="emoji-btn" data-emoji="üçù" title="‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡πá‡∏ï‡∏ï‡∏µ‡πâ">üçù</span>
                                        <span class="emoji-btn" data-emoji="üç≤" title="‡∏´‡∏°‡πâ‡∏≠‡πÑ‡∏ü">üç≤</span>
                                        <span class="emoji-btn" data-emoji="ü•ó" title="‡∏™‡∏•‡∏±‡∏î">ü•ó</span>
                                        <span class="emoji-btn" data-emoji="üç≥" title="‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß">üç≥</span>
                                        <span class="emoji-btn" data-emoji="ü•ò" title="‡πÅ‡∏Å‡∏á">ü•ò</span>
                                        <span class="emoji-btn" data-emoji="üç§" title="‡∏Å‡∏∏‡πâ‡∏á‡∏ó‡∏≠‡∏î">üç§</span>
                                        <span class="emoji-btn" data-emoji="üç£" title="‡∏ã‡∏π‡∏ä‡∏¥">üç£</span>
                                        
                                        <!-- ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° -->
                                        <span class="emoji-btn" data-emoji="‚òï" title="‡∏Å‡∏≤‡πÅ‡∏ü">‚òï</span>
                                        <span class="emoji-btn" data-emoji="ü•§" title="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">ü•§</span>
                                        <span class="emoji-btn" data-emoji="üßÉ" title="‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ">üßÉ</span>
                                        <span class="emoji-btn" data-emoji="üç∫" title="‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå">üç∫</span>
                                        <span class="emoji-btn" data-emoji="üç∑" title="‡πÑ‡∏ß‡∏ô‡πå">üç∑</span>
                                        <span class="emoji-btn" data-emoji="üßä" title="‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á">üßä</span>
                                        
                                        <!-- ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô -->
                                        <span class="emoji-btn" data-emoji="üç∞" title="‡πÄ‡∏Ñ‡πâ‡∏Å">üç∞</span>
                                        <span class="emoji-btn" data-emoji="üçÆ" title="‡∏û‡∏∏‡∏î‡∏î‡∏¥‡πâ‡∏á">üçÆ</span>
                                        <span class="emoji-btn" data-emoji="üç≠" title="‡∏≠‡∏°‡∏¢‡∏¥‡πâ‡∏°">üç≠</span>
                                        <span class="emoji-btn" data-emoji="üç™" title="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™</span>
                                        <span class="emoji-btn" data-emoji="üç©" title="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç©</span>
                                        <span class="emoji-btn" data-emoji="üç´" title="‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï">üç´</span>
                                        
                                        <!-- ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ -->
                                        <span class="emoji-btn" data-emoji="üõí" title="‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">üõí</span>
                                        <span class="emoji-btn" data-emoji="üí∏" title="‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å">üí∏</span>
                                        <span class="emoji-btn" data-emoji="üìâ" title="‡∏Å‡∏£‡∏≤‡∏ü‡∏•‡∏á">üìâ</span>
                                        <span class="emoji-btn" data-emoji="‚ö°" title="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‚ö°</span>
                                        <span class="emoji-btn" data-emoji="üíß" title="‡∏ô‡πâ‡∏≥">üíß</span>
                                        <span class="emoji-btn" data-emoji="üî•" title="‡πÅ‡∏Å‡πä‡∏™">üî•</span>
                                        <span class="emoji-btn" data-emoji="üë•" title="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">üë•</span>
                                        <span class="emoji-btn" data-emoji="üè¢" title="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£">üè¢</span>
                                        <span class="emoji-btn" data-emoji="üì¢" title="‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤">üì¢</span>
                                        <span class="emoji-btn" data-emoji="üîß" title="‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á">üîß</span>
                                        <span class="emoji-btn" data-emoji="üöö" title="‡∏Ç‡∏ô‡∏™‡πà‡∏á">üöö</span>
                                        <span class="emoji-btn" data-emoji="üìã" title="‡∏†‡∏≤‡∏©‡∏µ">üìã</span>
                                        
                                        <!-- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
                                        <span class="emoji-btn" data-emoji="üì¶" title="‡∏Å‡∏•‡πà‡∏≠‡∏á">üì¶</span>
                                        <span class="emoji-btn" data-emoji="üß∞" title="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠">üß∞</span>
                                        <span class="emoji-btn" data-emoji="üçΩÔ∏è" title="‡∏ä‡πâ‡∏≠‡∏ô‡∏™‡πâ‡∏≠‡∏°">üçΩÔ∏è</span>
                                        <span class="emoji-btn" data-emoji="ü•Ñ" title="‡∏ä‡πâ‡∏≠‡∏ô">ü•Ñ</span>
                                        <span class="emoji-btn" data-emoji="üç¥" title="‡∏ä‡πâ‡∏≠‡∏ô‡∏™‡πâ‡∏≠‡∏°">üç¥</span>
                                    </div>
                                    <div class="mt-2 text-end">
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="document.getElementById('emojiPicker').style.display='none'">
                                            ‡∏õ‡∏¥‡∏î
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 form-check">
                        {{ form.is_active }}
                        <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                            ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-check-circle me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.emoji-btn {
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.5rem;
    text-align: center;
    transition: all 0.2s ease;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
}

.emoji-btn:hover {
    background: var(--bg-tertiary);
    transform: scale(1.2);
    border-color: var(--primary-color);
}

.emoji-grid::-webkit-scrollbar {
    width: 8px;
}

.emoji-grid::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 4px;
}

.emoji-grid::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const emojiPickerBtn = document.getElementById('emojiPickerBtn');
    const emojiPicker = document.getElementById('emojiPicker');
    const iconInput = document.getElementById('{{ form.icon.id_for_label }}');
    
    // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î emoji picker
    if (emojiPickerBtn) {
        emojiPickerBtn.addEventListener('click', function() {
            if (emojiPicker.style.display === 'none') {
                emojiPicker.style.display = 'block';
            } else {
                emojiPicker.style.display = 'none';
            }
        });
    }
    
    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å emoji
    const emojiBtns = document.querySelectorAll('.emoji-btn');
    emojiBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            const emoji = this.getAttribute('data-emoji');
            if (iconInput) {
                iconInput.value = emoji;
                emojiPicker.style.display = 'none';
                // ‡πÅ‡∏™‡∏î‡∏á emoji ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
                emojiPickerBtn.textContent = emoji;
            }
        });
    });
    
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ emoji ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
    if (iconInput && iconInput.value && iconInput.value.match(/[\u{1F300}-\u{1F9FF}]/u)) {
        emojiPickerBtn.textContent = iconInput.value;
    }
});
</script>
{% endblock %}

